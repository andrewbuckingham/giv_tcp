# GivTCP Environment Configuration
# Copy this file to .env and update with your settings
#
# Usage with docker-compose:
#   1. Copy this file: cp .env.example .env
#   2. Edit .env with your inverter details
#   3. Run: docker-compose up -d

# ============================================================
# TIMEZONE
# ============================================================
TZ=Europe/London

# ============================================================
# INVERTER CONFIGURATION
# ============================================================
# IP address of your GivEnergy inverter
INVERTOR_IP=192.168.1.100

# Number of batteries connected (0-3)
INVERTOR_NUM_BATTERIES=1

# ============================================================
# MQTT CONFIGURATION
# ============================================================
# MQTT broker address (use 127.0.0.1 for internal broker)
MQTT_ADDRESS=127.0.0.1

# MQTT authentication (leave empty if not required)
MQTT_USERNAME=
MQTT_PASSWORD=

# MQTT topic prefix for all messages
MQTT_TOPIC=GivEnergy

# ============================================================
# HOME ASSISTANT INTEGRATION
# ============================================================
# Enable automatic discovery in Home Assistant
HA_AUTO_D=True

# ============================================================
# LOGGING AND DEBUG
# ============================================================
# Logging level: Debug, Info, Warning, Error, Critical
LOG_LEVEL=Info

# Print raw register data (useful for debugging)
PRINT_RAW=False

# ============================================================
# APPLICATION SETTINGS
# ============================================================
# Self-run loop interval in seconds (how often to poll inverter)
SELF_RUN_LOOP_TIMER=5

# Number of retries for queue operations
QUEUE_RETRIES=2

# Cache storage location inside container
CACHELOCATION=/config

# Data smoothing level: Off, Low, Medium, High
DATASMOOTHER=High

# ============================================================
# INFLUXDB OUTPUT (Optional)
# ============================================================
# Enable InfluxDB output
INFLUX_OUTPUT=False

# InfluxDB connection details (if INFLUX_OUTPUT=True)
INFLUX_URL=
INFLUX_TOKEN=
INFLUX_BUCKET=
INFLUX_ORG=

# ============================================================
# PALM (Power Arbitrage Load Management) (Optional)
# ============================================================
# Enable PALM features for Octopus Agile tariff optimization
PALM_WINTER=False
PALM_SHOULDER=False

# PALM battery SOC targets (%)
PALM_MIN_SOC_TARGET=75
PALM_MAX_SOC_TARGET=100

# PALM battery settings
PALM_BATT_RESERVE=4
PALM_BATT_UTILISATION=0.85

# ============================================================
# PHASE 1-5 REFACTORING FEATURE FLAGS
# ============================================================
# These flags enable new implementations from the refactoring project.
# Set to "true" to enable, "false" to use legacy code.
# All flags default to "false" for backward compatibility.

# Phase 2: Thread-safe Cache Repository
# Eliminates pickle file race conditions using proper locking
USE_NEW_CACHE=false

# Phase 5: ThreadLockManager
# Eliminates TOCTOU vulnerabilities in file-based locking
# Uses proper threading primitives instead of file locks
USE_NEW_LOCKS=false

# Phase 3: Service Layer Extraction
# Breaks monolithic getData() into 6 focused, testable services:
#   - HardwareCommunicationService
#   - EnergyCalculationService
#   - PowerCalculationService
#   - BatteryMetricsService
#   - ControlModeService
#   - DataProcessingService
USE_NEW_SERVICES=false

# ============================================================
# RECOMMENDED ROLLOUT STRATEGY
# ============================================================
# 1. Initial deployment - all flags false (legacy code)
# 2. Enable Phase 2 - USE_NEW_CACHE=true
# 3. Monitor for 24-48 hours
# 4. Enable Phase 5 - USE_NEW_LOCKS=true
# 5. Monitor for 24-48 hours
# 6. Enable Phase 3 - USE_NEW_SERVICES=true
# 7. Monitor for stability
#
# Instant rollback: Set any flag back to "false"

# ============================================================
# TESTING CONFIGURATION (All new features enabled)
# ============================================================
# Uncomment these to test all new implementations:
# USE_NEW_CACHE=true
# USE_NEW_LOCKS=true
# USE_NEW_SERVICES=true
